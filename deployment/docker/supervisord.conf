[supervisord]
nodaemon=true
user=ris
logfile=/app/logs/supervisord.log
pidfile=/app/logs/supervisord.pid
loglevel=info

[program:django]
command=gunicorn reez.wsgi:application --bind 0.0.0.0:8000 --workers 4 --threads 2 --timeout 300 --max-requests 1000 --max-requests-jitter 100 --preload --access-logfile /app/logs/gunicorn-access.log --error-logfile /app/logs/gunicorn-error.log --log-level info
directory=/app
user=ris
autostart=true
autorestart=true
redirect_stderr=true
stdout_logfile=/app/logs/django.log
stdout_logfile_maxbytes=50MB
stdout_logfile_backups=5
stderr_logfile=/app/logs/django-error.log
stderr_logfile_maxbytes=50MB
stderr_logfile_backups=5

[program:nextjs]
command=npm start
directory=/app/ris-frontend
user=ris
autostart=true
autorestart=true
redirect_stderr=true
stdout_logfile=/app/logs/nextjs.log
stdout_logfile_maxbytes=50MB
stdout_logfile_backups=5
stderr_logfile=/app/logs/nextjs-error.log
stderr_logfile_maxbytes=50MB
stderr_logfile_backups=5
environment=NODE_ENV=production,NEXT_PUBLIC_API_URL="%(ENV_NEXT_PUBLIC_API_URL)s"

[program:daphne]
command=daphne -b 0.0.0.0 -p 8001 reez.asgi:application
directory=/app
user=ris
autostart=true
autorestart=true
redirect_stderr=true
stdout_logfile=/app/logs/daphne.log
stdout_logfile_maxbytes=50MB
stdout_logfile_backups=5

[program:celery-worker]
command=celery -A reez worker --loglevel=info --concurrency=2
directory=/app
user=ris
autostart=true
autorestart=true
redirect_stderr=true
stdout_logfile=/app/logs/celery-worker.log
stdout_logfile_maxbytes=50MB
stdout_logfile_backups=5
stopwaitsecs=600
killasgroup=true
priority=1000

[program:celery-beat]
command=celery -A reez beat --loglevel=info --pidfile=/app/logs/celerybeat.pid
directory=/app
user=ris
autostart=true
autorestart=true
redirect_stderr=true
stdout_logfile=/app/logs/celery-beat.log
stdout_logfile_maxbytes=50MB
stdout_logfile_backups=5
stopwaitsecs=600
killasgroup=true
priority=1000

[unix_http_server]
file=/app/logs/supervisor.sock
chmod=0700
chown=ris:ris

[supervisorctl]
serverurl=unix:///app/logs/supervisor.sock

[rpcinterface:supervisor]
supervisor.rpcinterface_factory = supervisor.rpcinterface:make_main_rpcinterface